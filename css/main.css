/* --- 1. DESIGN TOKENS --- */
:root {
    --bg-app: #0d0f12;
    --bg-card: #161a1f;
    --bg-input: #1f242d;
    --text-main: #e2e8f0;
    --text-dim: #718096;
    --accent: #00d4ff;
    --accent-glow: rgba(0, 212, 255, 0.3);
    --success: #00ff9f;
    --success-glow: rgba(0, 255, 159, 0.2);
    --border-color: #2d3748;
    
    --symbol-size: 3.8rem;
    --symbol-mini: 2rem;
    --border-radius: 4px;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: 'JetBrains Mono', monospace;
    background-color: var(--bg-app);
    background-image: radial-gradient(circle at 50% 50%, #1a202c 0%, #0d0f12 100%);
    color: var(--text-main);
    line-height: 1.5;
    min-height: 100vh;
}

h1, h2, h3 { font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 2px; }

/* --- 2. HEADER --- */
.app-header {
    background: rgba(22, 26, 31, 0.9);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border-color);
    padding: 0.6rem 2rem;
    position: sticky; top: 0; z-index: 1000;
}
.header-content {
    max-width: 1300px; margin: 0 auto;
    display: flex; align-items: center; justify-content: space-between;
}
.brand-group h1 { margin: 0; font-size: 1.8rem; color: var(--accent); text-shadow: 0 0 15px var(--accent-glow); }
#game-seed-display { font-size: 0.7rem; color: var(--text-dim); opacity: 0.5; }

.status-group { flex-grow: 1; display: flex; justify-content: center; }
.progress-wrapper {
    display: flex; align-items: center; gap: 1rem;
    background: #000; padding: 0.4rem 1rem; border: 1px solid var(--border-color);
}
.progress-track { width: 150px; height: 4px; background: #222; }
#progress-fill { width: 0%; height: 100%; background: var(--success); box-shadow: 0 0 10px var(--success); transition: width 0.4s; }

#menu-button {
    background: transparent; border: 1px solid var(--accent); color: var(--accent);
    padding: 0.4rem 1rem; font-size: 0.8rem; cursor: pointer;
}

/* --- 3. LAYOUT --- */
.game-container {
    display: grid; grid-template-columns: 1fr 380px; gap: 2rem;
    max-width: 1300px; margin: 2rem auto; padding: 0 1.5rem;
}

/* --- 4. WORKSPACE --- */
.sticky-palette-container {
    position: sticky; top: 6rem;
    background: rgba(22, 26, 31, 0.6); padding: 1.25rem;
    margin-bottom: 2rem; border: 1px solid var(--border-color); z-index: 100;
}
.palette { display: flex; gap: 1.2rem; justify-content: center; }

.rules-grid { display: flex; flex-direction: column; gap: 1rem; }
.rule-form {
    background: var(--bg-card); padding: 1.5rem;
    display: flex; align-items: center; justify-content: center;
    gap: 1.5rem; border: 1px solid var(--border-color);
}
.rule-arrow { font-size: 1.8rem; color: var(--text-dim); opacity: 0.3; }

/* --- 5. DROP ZONES & SYMBOLS --- */
.drop-zone {
    width: var(--symbol-size); height: var(--symbol-size);
    background: #000; border: 1px solid var(--border-color);
    display: flex; align-items: center; justify-content: center; cursor: pointer;
}
.drop-zone:empty::after { content: ''; width: 6px; height: 6px; border: 1px solid #333; border-radius: 50%; }

.symbol {
    width: var(--symbol-size); height: var(--symbol-size);
    display: flex; align-items: center; justify-content: center;
    font-size: 2.2rem; cursor: grab; user-select: none;
    background-image: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.1) 100%);
    box-shadow: 0 4px 10px rgba(0,0,0,0.4); border: 1px solid rgba(0,0,0,0.2);
}
.symbol.start-symbol { border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 0 10px rgba(217, 83, 79, 0.3); }
.symbol.selected { outline: 2px solid var(--accent); outline-offset: 4px; transform: translateY(-3px); }

/* --- 6. SIDEBAR (UNBALANCED BOX FIX) --- */
.sidebar {
    background: rgba(22, 26, 31, 0.4);
    border: 1px solid var(--border-color);
    padding: 1.5rem;
    align-self: start; /* Prevents stretching to the bottom */
}
.sidebar-header { margin-bottom: 1.2rem; padding-bottom: 0.8rem; border-bottom: 1px solid #222; }
.sidebar h2 { margin: 0; font-size: 1.1rem; }
.instruction { color: var(--text-dim); font-size: 0.7rem; margin-top: 0.4rem; }

.examples-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.6rem; }
.examples-list li {
    padding: 0.8rem 1rem;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #222;
    display: flex; align-items: center; cursor: pointer;
}
.examples-list li.is-valid { border-color: var(--success); background: var(--success-glow); }

/* CONTENT WRAPPERS - CORE FIX FOR HORIZONTAL ALIGNMENT */
.example-content-wrapper {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    gap: 0.4rem;
}

.examples-list .symbol { 
    width: var(--symbol-mini) !important; height: var(--symbol-mini) !important; 
    font-size: 1.1rem !important; box-shadow: none; border: none;
}

/* --- 7. DERIVATION OVERLAY (BROKEN LAYOUT FIX) --- */
.derivation-visualizer {
    position: fixed; z-index: 2000;
    background: #000; border: 1px solid var(--accent);
    padding: 1.5rem; box-shadow: 0 0 60px rgba(0,0,0,0.9);
    max-width: 600px;
}
.derivation-visualizer .step {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 2rem;
    padding: 0.6rem 0;
    border-bottom: 1px solid #1a1a1a;
    width: 100%;
}
.derivation-visualizer .step:last-child { border-bottom: none; }

/* Ensure the sequence inside the step is also horizontal */
.derivation-visualizer .example-content-wrapper {
    display: flex !important;
    flex-direction: row !important;
    gap: 0.3rem;
}

.derivation-visualizer .step-rule {
    flex-shrink: 0;
    display: flex; align-items: center; gap: 0.4rem;
    background: #111; padding: 0.3rem 0.6rem;
    font-size: 0.7rem; color: var(--accent); border: 1px solid #333;
}

.derivation-visualizer .symbol {
    width: 1.6rem !important; height: 1.6rem !important;
    font-size: 0.9rem !important;
}
.symbol.replaced-symbol { outline: 1px solid var(--accent); box-shadow: 0 0 10px var(--accent-glow); }

/* --- 8. SYSTEM OVERLAYS --- */
.overlay {
    position: fixed; inset: 0;
    background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(8px);
    display: flex; align-items: center; justify-content: center; z-index: 9999;
}
.overlay.hidden { display: none !important; }

.overlay-card {
    background: var(--bg-card); padding: 3rem;
    border: 1px solid var(--accent); text-align: center;
    max-width: 450px; width: 90%;
}
.overlay-actions { display: flex; flex-direction: column; gap: 1rem; margin-top: 2rem; }

button {
    font-family: 'Rajdhani', sans-serif; letter-spacing: 2px; text-transform: uppercase;
    font-weight: bold; padding: 0.7rem 1.4rem; cursor: pointer; border: none;
}
.btn-primary { background: var(--accent); color: #000; }
.btn-secondary { background: transparent; border: 1px solid var(--text-dim); color: var(--text-dim); }

/* --- 9. RESPONSIVE --- */
@media (max-width: 1000px) {
    .game-container { grid-template-columns: 1fr; }
    .sidebar { order: 2; margin-top: 2rem; width: 100%; }
}
